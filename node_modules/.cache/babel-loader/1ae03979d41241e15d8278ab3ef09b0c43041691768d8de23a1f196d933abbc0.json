{"ast":null,"code":"import { ref, watch } from \"vue\";\nimport axios from \"@/util/axios\";\nimport { ElMessage } from \"element-plus\";\n\n// 定义父组件传递的参数，并初始化\n\nexport default {\n  __name: 'editQuestion',\n  props: {\n    dialogVisible: {\n      type: Boolean,\n      default: false,\n      required: true\n    },\n    id: {\n      type: Number,\n      default: -1,\n      required: true\n    }\n  },\n  emits: ['update:modelValue', 'initList'],\n  setup(__props, {\n    expose: __expose,\n    emit: emits\n  }) {\n    __expose();\n    const props = __props;\n\n    // 初始化问题表数据\n    const tableData = ref([]);\n\n    /**\r\n     * 获取问题表数据\r\n     * @returns {Promise<void>}\r\n     */\n    const initQuestionList = async () => {\n      // 请求数据\n      const res = await axios.get('/api/survey-question/all');\n      // 赋值给tableData\n      tableData.value = res.data.data.surveyQuestions;\n    };\n\n    /**\r\n     * 将类型ID翻译成对应的类型名称\r\n     */\n    const cateFormatter = row => {\n      switch (row.surveyCateId) {\n        case 1:\n          return \"单选题\";\n        case 2:\n          return \"多选题\";\n        case 3:\n          return \"判断题\";\n        default:\n          return \"简答题\";\n      }\n    };\n\n    // 初始化assembly\n    const assembly = ref({});\n\n    /**\r\n     * 根据ID获取要编辑问题的问卷的原始数据\r\n     * @param id\r\n     * @returns {Promise<void>}\r\n     */\n    const initData = async id => {\n      const res = await axios.get('/api/survey-assembly/one/' + id);\n      assembly.value = res.data.data.surveyAssembly;\n    };\n\n    // 监听本页面dialogVisible（是否可见）值的变化\n    watch(() => props.dialogVisible, () => {\n      if (props.dialogVisible === true) {\n        // 本页面可见时，获取问题表数据\n        initQuestionList();\n        // 根据父组件传入的id获取要编辑问题的问卷的原始数据\n        initData(props.id);\n      }\n    });\n\n    // 初始化要加入该问卷的问题IDs\n    const questionIds = ref(\"0\");\n\n    /**\r\n     * 表格左侧复选框改变时调用\r\n     * @param val\r\n     */\n    const handleSelectionChange = val => {\n      // 获取选中的问题的ID数组\n      let idList = val.map(item => {\n        return item.id;\n      });\n      if (idList.length === 0) {\n        questionIds.value = \"0\";\n        return;\n      }\n      // 将idList中的ID拼接成以逗号分隔的字符串\n      let itemIds = \"\";\n      idList.forEach((item, index) => {\n        itemIds += item;\n        if (index !== idList.length - 1) {\n          itemIds += \",\";\n        }\n      });\n      console.log(itemIds);\n      // 赋值给questionIds\n      questionIds.value = itemIds;\n    };\n\n    /**\r\n     * 点击确定组卷时调用\r\n     * @returns {Promise<void>}\r\n     */\n    const handleConfirm = async () => {\n      // 修改原来assembly的surveyQuestonIds为questionIds的值\n      assembly.value.surveyQuestonIds = questionIds.value;\n      // 向后端发送修改数据请求\n      let res = await axios.post('/api/survey-assembly/edit', assembly.value);\n      if (res.data.success === true) {\n        ElMessage.success(\"执行成功！\");\n        // 刷新父组件表格数据\n        emits('initList');\n        // 关闭该弹窗\n        handleClose();\n      } else {\n        ElMessage.error(res.data.msg);\n      }\n    };\n\n    // 定义要调用的父组件的方法\n\n    /**\r\n     * 点击关闭或取消时调用\r\n     */\n    const handleClose = () => {\n      // 设置dialogVisible为不可见\n      emits('update:modelValue', false);\n    };\n    const __returned__ = {\n      props,\n      tableData,\n      initQuestionList,\n      cateFormatter,\n      assembly,\n      initData,\n      questionIds,\n      handleSelectionChange,\n      handleConfirm,\n      emits,\n      handleClose,\n      ref,\n      watch,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","axios","ElMessage","tableData","initQuestionList","res","get","value","data","surveyQuestions","cateFormatter","row","surveyCateId","assembly","initData","id","surveyAssembly","props","dialogVisible","questionIds","handleSelectionChange","val","idList","map","item","length","itemIds","forEach","index","console","log","handleConfirm","surveyQuestonIds","post","success","emits","handleClose","error","msg"],"sources":["C:/Users/林ＺＨ/Desktop/survey/src/views/assembly/components/editQuestion.vue"],"sourcesContent":["<template>\r\n    <el-dialog\r\n        model-value=\"dialogVisible\"\r\n        title=\"选项管理\"\r\n        width=\"50%\"\r\n        @close=\"handleClose\"\r\n        center\r\n    >\r\n        请选择要组卷的题目：\r\n        <el-table :data=\"tableData\" stripe @selection-change=\"handleSelectionChange\" style=\"width: 100%\">\r\n            <!-- 复选框 -->\r\n            <el-table-column type=\"selection\" width=\"50\"></el-table-column>\r\n            <el-table-column prop=\"id\" label=\"ID\" width=\"80\" />\r\n            <el-table-column prop=\"content\" label=\"问题\" width=\"250\" />\r\n            <el-table-column prop=\"description\" label=\"描述\" width=\"250\" />\r\n            <el-table-column prop=\"surveyCateId\" label=\"分类ID\" width=\"120\" :formatter=\"cateFormatter\"/>\r\n            <el-table-column prop=\"surveyItemIds\" label=\"选项ID\" width=\"120\" />\r\n        </el-table>\r\n        <el-button type=\"primary\" @click=\"handleConfirm\">确定组卷</el-button>\r\n    </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport {defineEmits, defineProps, ref, watch} from \"vue\";\r\nimport axios from \"@/util/axios\";\r\nimport {ElMessage} from \"element-plus\";\r\n\r\n// 定义父组件传递的参数，并初始化\r\nconst props = defineProps(\r\n    {\r\n        dialogVisible: {\r\n            type: Boolean,\r\n            default: false,\r\n            required: true\r\n        },\r\n        id: {\r\n            type: Number,\r\n            default: -1,\r\n            required: true\r\n        }\r\n    }\r\n);\r\n\r\n// 初始化问题表数据\r\nconst tableData = ref([]);\r\n\r\n/**\r\n * 获取问题表数据\r\n * @returns {Promise<void>}\r\n */\r\nconst initQuestionList = async () => {\r\n    // 请求数据\r\n    const res = await axios.get('/api/survey-question/all');\r\n    // 赋值给tableData\r\n    tableData.value = res.data.data.surveyQuestions;\r\n};\r\n\r\n/**\r\n * 将类型ID翻译成对应的类型名称\r\n */\r\nconst cateFormatter = (row) => {\r\n    switch (row.surveyCateId) {\r\n        case 1:\r\n            return \"单选题\"\r\n        case 2:\r\n            return \"多选题\"\r\n        case 3:\r\n            return \"判断题\"\r\n        default:\r\n            return \"简答题\"\r\n    }\r\n}\r\n\r\n// 初始化assembly\r\nconst assembly = ref({});\r\n\r\n/**\r\n * 根据ID获取要编辑问题的问卷的原始数据\r\n * @param id\r\n * @returns {Promise<void>}\r\n */\r\nconst initData = async (id) => {\r\n  const res = await axios.get('/api/survey-assembly/one/' + id);\r\n  assembly.value = res.data.data.surveyAssembly;\r\n}\r\n\r\n// 监听本页面dialogVisible（是否可见）值的变化\r\nwatch(\r\n    () => props.dialogVisible,\r\n    () => {\r\n        if (props.dialogVisible === true) {\r\n            // 本页面可见时，获取问题表数据\r\n            initQuestionList();\r\n            // 根据父组件传入的id获取要编辑问题的问卷的原始数据\r\n            initData(props.id);\r\n        }\r\n    },\r\n);\r\n\r\n// 初始化要加入该问卷的问题IDs\r\nconst questionIds = ref(\"0\");\r\n\r\n/**\r\n * 表格左侧复选框改变时调用\r\n * @param val\r\n */\r\nconst handleSelectionChange = (val) => {\r\n    // 获取选中的问题的ID数组\r\n    let idList = val.map((item) =>{\r\n        return item.id;\r\n    });\r\n    if (idList.length === 0) {\r\n        questionIds.value = \"0\";\r\n        return;\r\n    }\r\n    // 将idList中的ID拼接成以逗号分隔的字符串\r\n    let itemIds = \"\";\r\n    idList.forEach((item, index)=>{\r\n        itemIds += item;\r\n        if (index !== idList.length-1) {\r\n            itemIds += \",\";\r\n        }\r\n    })\r\n    console.log(itemIds);\r\n    // 赋值给questionIds\r\n    questionIds.value = itemIds;\r\n}\r\n\r\n/**\r\n * 点击确定组卷时调用\r\n * @returns {Promise<void>}\r\n */\r\nconst handleConfirm = async () => {\r\n    // 修改原来assembly的surveyQuestonIds为questionIds的值\r\n    assembly.value.surveyQuestonIds = questionIds.value;\r\n    // 向后端发送修改数据请求\r\n    let res = await axios.post('/api/survey-assembly/edit', assembly.value);\r\n    if (res.data.success === true) {\r\n        ElMessage.success(\"执行成功！\");\r\n        // 刷新父组件表格数据\r\n        emits('initList');\r\n        // 关闭该弹窗\r\n        handleClose();\r\n    } else {\r\n        ElMessage.error(res.data.msg);\r\n    }\r\n}\r\n\r\n// 定义要调用的父组件的方法\r\nconst emits = defineEmits(['update:modelValue','initList']);\r\n\r\n/**\r\n * 点击关闭或取消时调用\r\n */\r\nconst handleClose = () => {\r\n    // 设置dialogVisible为不可见\r\n    emits('update:modelValue', false);\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}